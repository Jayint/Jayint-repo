# Repo2Build

做一个Agent，专门将LLM的文本输出转换成bash指令

一个旨在复现论文时为对应代码仓库配置可执行docker环境的agent。

目的：给定一篇论文对应的GitHub仓库链接，自动将仓库clone到本地并用agent为其配置环境（包括依赖包的安装等操作），使得论文对应的代码仓库能够成功运行起来。

核心组件：

1. Sandbox（Docker Engine）：启动一个容器（如 python：3.10），通过container.exec_run() 执行 Bash 命令。
    
    重要机制：每一个bash命令执行前，调用 container.commit()将当前状态保存为新镜像，然后再执行对应的bash命令，如果bash命令执行失败了，则销毁容器并从上一个成功的镜像重启（这是回滚机制，为了避免失败的指令对环境进行污染）。
    
2. Planner（LLM）：Agent的大脑，规划配置环境的过程。可以自行选择在docker容器里安装pipreqs、poetry、pipdeptree、pytest等用于配置环境的工具。并在构建环境过程中解决包冲突的问题。
    
    采用ReAct格式的思维链，包括 Thought（模型的思考）、Action（要执行的bash指令）、Observation（指令执行后环境的反馈）。
    
    流程：每次LLM输出包括Thought和Action的文本内容后，Agent提取出文本中的Bash指令并解析，然后在环境中执行对应的bash指令，再将环境执行的结果反馈（Observation）记录下来，与Thought、Action一并打包发给LLM，让其根据历史的CoT，给出下一步的规划。
    
3. Synthesizer (Dockerfile Generator): 在Agent构建环境的过程中，对于执行成功的指令，将其以Dockerfile对应的语法记录为一条Dockerfile语句。注意是成功的指令才收集下来，当环境成功构建完成之后，也会相应地生成一份Dockerfile文件。这个Dockerfile文件用于是整个项目最后的产物，用于复现该构建过程。也就是说，我只需要运行该Dockerfile文件，最后产生的Docker image，再去生成对应容器的时候，在这个容器里该仓库要能够成功运行。

以上是该项目的一个demo。

后续还要加入轨迹压缩的模块，用于减少构建环境的成本。